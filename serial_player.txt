3.2.1 инструкция по контролю
Вот как работает чип управления
Функциональные параметры, соответствующие команде CMD (16 бит)
0x01 следующая песня
0x02 предыдущая песня
0x03 укажите дорожку (NUM), как описано в 3.4.1
0x04 объем+
0x05 объем 
0x06 указанный объем см. В разделе 3.4.2
0x08 одиночный цикл, обозначающий воспроизведение трека, подробно описанный в 3.4.3
0x09 указывает устройство воспроизведения (см. 3.4.4
0x0A переходит в режим сна - низкое энергопотребление 10 мА см. 3.4.5
0x0B пробуждение сна
Чип 0x0C сбрасывает любое состояние эффективно
Воспроизведение 0x0D
0x0E пауза
0x0F указывает имя файла папки для воспроизведения, как описано в 3.4.6
0x13 межстраничные объявления подробно описаны в 3.4.7
0x14 поддержка 1000 треков в одной папке
0x15 останавливает воспроизведение фоновой музыки (см. 3.4.8)
0x16 останавливается, как описано в 3.4.8
0x17 укажите папку для воспроизведения в цикле Подробнее см. 3.4.9
0x18 указывает, что корневой каталог перетасовывается, как описано в 3.4.10
0x19 устанавливает циклическое воспроизведение для текущей воспроизводимой дорожки (см. 3.4.11
0x1A включает и выключает выход ЦАП чипа, как описано в 3.4.12
0x21 комбинированное воспроизведение см. В разделе 3.4.13
0x22 укажите громкость при заданном воспроизведении файлов (см. 3.4.14
0x25 многопапочная вставка подробно описана в разделе 3.4.15
Технология Гуанчжоу Юэсин электронная, ЛТД www.YX080.com руководство по эксплуатации чипа yx6300-24SS
Продажи QQ: 2213825928 8
3.2.2 инструкции по запросу
Вот запрос состояния чипа и связанных с ним параметров
Подробная информация о команде CMD (проверьте
Запрос) соответствующий функциональный параметр (16 бит)
0x3c зарезервировано
0x3d зарезервировано
0x3e зарезервировано
0x3f запрашивает онлайн-устройства, как описано в разделе 3.5.1
0x40 возвращает ошибку, повторная передача запроса
0x41 ответ
0x42 текущее состояние запроса подробно описано в 3.4.10
0x43 запрос текущего объема
0x44 запрос текущего сохранения эквалайзера
0x45 зарезервировано эта версия сохраняет эту функцию
0x46 зарезервировано эта версия сохраняет эту функцию
0x47 общее количество запросов к файлам UDISK общее количество файлов внутри USB-накопителя [файлы MP3 / WAV]
0x48 общее количество запросов TF-файлов общее количество файлов внутри TF-карты [MP3 / WAV-файлы]
0x49 общее количество файлов для запроса FLASH общее количество файлов для FLASH [файлы MP3 / WAV]
0x4B запрашивает текущий физический порядок треков UDISK
0x4C запрашивает текущий физический порядок треков TF
0x4D запрашивает текущий физический порядок треков FLASH
0x4E запрашивает общее количество треков в указанной папке, как описано в разделе 3.5.3
0x4F запрашивает общее количество папок для текущего устройства (см. 3.5.4
0x47 запрашивает общее количество файлов UDISK внутри USB-накопителя


3.3 данные, возвращаемые чипом
Чип будет возвращать данные в ключевых местах.Для потребителей контролировать работая состояние обломока
"Данные об успешной инициализации чипа
"Чип закончил воспроизведение данных текущего трека
"Чип успешно получил команду, возвращающую ACK (ответ)
"Чип получил ошибку в кадре данных [включая полную конфискацию данных, ошибку проверки в двух случаях]
"Когда чип занят, есть данные, и чип вернет занятую инструкцию
"U-диск, TF-карта вставлена и вытащена, все данные возвращаются


3.3.1 данные, возвращаемые при включении микросхемы
(1), чип питания, требуется некоторое время для инициализации, это время необходимо в соответствии с TF-картой, U-диском, документами устройства SPIFLASH
Сколько штук решает, как правило, менее 500 мс за это время.Если за это время данные инициализации чипа не были отправлены
Выходит, что ошибка инициализации чипа, пожалуйста, проверьте аппаратное соединение
(2), инициализация чипа возвращает данные для текущей допустимой папки, например, возвращает 7E FF 06 3F 00 00 03 xx xx EF
= = > Где 0x03 означает, что USB-накопитель и TF оба устройства находятся в сети
USB-накопитель -- онлайн 7E FF 06 3F 00 00 01 xx xx EF да или связь между устройствами
TF -- онлайн 7E FF 06 3F 00 00 02 xx xx EF
ПК -- онлайн 7E FF 06 3F 00 00 04 xx xx EF
FLASH -- онлайн 7E FF 06 3F 00 00 08 xx xx EF
U диск, TF -- онлайн 7E FF 06 3F 00 00 03 xx xx EF
(3), MCU должен ждать инструкции инициализации чипа перед отправкой соответствующей команды управления,иначе отправленный чип инструкции не будет
Для обработки.Это также повлияет на нормальную инициализацию чипа.

3.3.2 данные, возвращенные после воспроизведения дорожки
7E FF 06 3C 00 00 01 xx xx EF конец 1-й песни конец 1-й песни
7E FF 06 3C 00 00 02 xx xx EF конец 2-й песни конец 2-й песни конец 3E FF 06 3C 00 00 02 xx xx EF конец 2-й песни конец
7E FF 06 3D 00 00 01 xx xx EF TF карта завершена
7E FF 06 3D 00 00 02 xx xx EF TF карта играла 2-я песня закончена
1-я песня 7E FF 06 3E 00 01 01 xx xx EF FOLDER1 закончена
2-я песня 7E FF 06 3E 00 02 02 xx xx EF folder2 песня 2-я песня 7E FF 06 3E 00 02 02 xx xx EF folder2 закончена
1, оспаривая много триггерных требований к воспроизведению, наш модуль исправляет, чтобы играть песню после автоматического входа в состояние остановки.Если пользователю нужно
Такие приложения.Вам просто нужно указать дорожку для воспроизведения.Таким образом, трек будет автоматически остановлен после завершения воспроизведения и ожидания команды
2, Кроме того, мы специально открываем IO в качестве индикатора состояния декодирования и паузы.См. раздел BUSY Foot
(1), низкий уровень выхода состояния воспроизведения[много усилителей имеют приглушенные ноги,могут быть прок

3.3.3 данные, возвращаемые чип-ответом
Чип возвращает ACK 7E FF 06 41 00 00 00 xx xx EF указывает на успешное получение данных
(1), чтобы повысить стабильность передачи данных, мы добавили обработку ответа, байт ACKB-это настройка, нужно ли отвечать
соглашаться。Преимущество этого заключается в том, чтобы гарантировать, что каждое сообщение имеет сигнал рукопожатия, полученный ответ указывает на данные, отправленные MCU, чип
Работа получена, немедленно обработана.
(2), для общего применения, клиент может выбрать свободно, без этой обработки ответа также в порядке.


3.3.4 данные, возвращенные чипом по ошибке
Возвращает занято 7E FF 06 40 00 00 01 xx xx EF модуль при инициализации файловой системы
В настоящее время спящий режим 7E FF 06 40 00 00 02 xx xx EF спящий режим поддерживается только для определенных устройств
Ошибка приема последовательного порта 7E FF 06 40 00 00 03 xx xx EF последовательный порт один кадр данных не был получен
Ошибка проверки 7e FF 06 40 00 00 04 xx xx EF и ошибка проверки
7E FF 06 40 00 00 05 xx xx EF файлы превышают заданный диапазон
Указанный файл не найден 7E FF 06 40 00 00 06 xx xx EF указанный файл не найден
Ошибка интерстицирования 7E FF 06 40 00 00 07 xx xx EF интерстицирование разрешено только в состоянии воспроизведения
Ошибка воспроизведения TF-карты 7E FF 06 40 00 00 08 xx xx EF ошибка чтения TF-карты или TF-карты
Ошибка инициализации вспышки 7E FF 06 40 00 00 09 xx xx EF ошибка информации о файловой системе внутри вспышки
Переход в режим сна 7E FF 06 40 00 00 0A xx xx EF переход в режим SLEPP
(1), чтобы повысить стабильность передачи данных, мы добавили механизм обработки ошибок данных.Модуль получает данные, которые не соответствуют формату，
Любая обратная связь.
(2), в условиях относительно плохой окружающей среды, настоятельно рекомендуется, чтобы клиенты обрабатывали этот заказ.Если среда приложения является общей, она не может быть обработана.
(3), модуль возвращается занят, в основном, когда модуль инициализируется, потому что модуль должен инициализировать файловую систему
(4), модуль после включения питания, входит в состояние устройства, устройство-СПИФЛАШ.Если SPIFLASH не находится в сети, он автоматически
Ложитесь спать.
(5), просто обратитесь к тестовой программе SDK, которую мы дали, портируйте часть работы последовательного порта, не будет ошибки проверки, в этом
Мы настоятельно рекомендуем пользователям использовать контрольные суммы, которые мы даем.Потому что никто не может гарантировать, что передача данных не пойдет не так.
(6), обозначение файла часть ошибки, пожалуйста, обратитесь к ниже для получения подробной информации


3.3.5 сообщение об отключении устройства
Вставка U-диска 7E FF 06 3A 00 00 01 xx xx EF
TF вставка 7E FF 06 3A 00 00 02 xx xx EF
ПК вставляет 7E FF 06 3A 00 00 04 xx xx EF
Отсоединение USB-накопителя 7E FF 06 3B 00 00 01 xx xx EF
TF вытащил 7E FF 06 3B 00 00 02 xx xx EF
ПК отключает 7E FF 06 3B 00 00 04 xx xx EF
(1), для того чтобы усилить гибкость обломока, мы специально увеличили, ввод оборудования, вытягивая обратную связь инструкции.Удобный для потребителя знать обломок
Рабочее состояние.
(2), когда устройство вставлено, мы по умолчанию входим в состояние ожидания устройства, если пользователь вставляет USB-накопитель с подсветкой, вы можете видеть U
Мигает индикатор диска.Вы также можете получить последовательное сообщение, в которое подключено устройство.

3.4 подробная инструкция по управлению последовательным портом
Ниже мы подробно расскажем о ключевых местах-для инструкций по управлению:
"Укажите дорожки для воспроизведения
"Укажите громкость воспроизведения
"Укажите устройство для воспроизведения
"Все инструкции по воспроизведению цикла
"Функция комбинированного воспроизведения[основные моменты]
"Воспроизведение определенных дорожек с параметрами громкости

3.4.1 указание инструкций по воспроизведению песни [можно напрямую ссылаться на 3.4.7]
Инструкции, которые мы даем, поддерживают воспроизведение указанного трека, диапазон выбора песни составляет от 0 до 3000.На самом деле это может поддержать больше，
Из-за причин, связанных с управлением файлами, поддержка слишком большого количества песен может привести к медленной работе системы, и общие приложения не должны поддерживать это
Сколько файлов.Если клиент имеет нетрадиционное применение, пожалуйста, свяжитесь с нами заранее.Эта инструкция в TF-карте и состоянии U-диска в соответствии с сохранением
Физический порядок хранения указан.FLASH также находится в физическом порядке[порядок копирования]
(1), например, выберите первую песню для воспроизведения, последовательный порт передает часть 7E FF 06 03 00 00 01 FF E6 EF
7E - - - стартовая команда
FF - - - информация о версии
06 - - - длина данных (без проверки)
03 - - - означает номер продукта
00 - - - требуется ли ответ[0x01: требуется ответ, 0x00: не нужно возвращать ответ]
00 - - - старший байт трека [DH]
01 - - - Low bytes of Track [DL], здесь представлена первая песня
FF - - - старший байт проверки
E7 - - - младший байт проверки
EF - - - команда завершения
(2), для выбора песни, если выбрать 100-ю песню, сначала 100 преобразуется в шестнадцатеричную систему, по умолчанию двухбайтовая, это 0x0064.
DH = 0x00 ; DL = 0x64
(3), другие операции и так далее, потому что во встроенном поле использование шестнадцатеричной системы является наиболее удобным видом операции.

3.4.2 указание команды воспроизведения громкости
(1), громкость по умолчанию для нашей системы-это уровень 30, если вы хотите установить громкость,вы можете напрямую отправить соответствующую инструкцию
(2), внутренняя установка обломока Тома разбивая ряд 0--30.Пожалуйста, обратите внимание пользователей
(3), например, укажите уровень громкости 15, последовательный порт отправляет команду: 7E FF 06 06 00 00 0F FF D5 EF
(4), DH = 0x00; DL = 0x0F, 15 преобразуется в шестнадцатеричную систему 0x000F.Вы можете обратиться к инструкциям в разделе "воспроизведение треков"

3.4.3 инструкция по воспроизведению одиночного цикла
Циклическое воспроизведение указанной дорожки 7E FF 06 08 00 00 01 xx xx EF циклическое воспроизведение первой песни
7E FF 06 08 00 00 02 xx xx EF loop играет вторую песню
7E FF 06 08 00 01 01 xx xx EF loop Play 1-я песня FOLDER1
(1), оспаривая некоторые требования, необходимые для воспроизведения одиночного цикла, мы улучшаем эту команду управления 0x08.При работе с TF-картой или U-диском，
Обратите внимание, что это физический порядок, в котором хранятся файлы.Но при работе со вспышкой он разделяется по папкам
Как указано, пожалуйста, обратитесь к приведенной выше инструкции по тестированию.
(2), в процессе воспроизведения цикла, вы можете нормально работать воспроизведение / пауза, предыдущая песня,следующая песня, регулировка громкости, включая эквалайзер и т. д.
И состояние по-прежнему воспроизводится в цикле.Состояние циклического воспроизведения можно отключить, указав, что один трек запускает воспроизведение или останавливается

3.4.4 указание устройств воспроизведения
(1), наш чип по умолчанию поддерживает 3 типа устройств воспроизведения, только устройство онлайн может назначить устройство для воспроизведения
Независимо от того, находится ли устройство в сети, наше программное обеспечение автоматически определяет, не требуется ли связь с пользователем.
(4), см. таблицу ниже, выберите соответствующую инструкцию для отправки
(3), после указанного оборудования.Чип автоматически переходит в состояние остановки декодирования, ожидая, когда пользователь укажет, что трек будет воспроизведен.От получения до указанного устройства
Внутренняя часть чипа завершает инициализацию файловой системы.Это займет около 200 мс.Пожалуйста, подождите 200 мс, прежде чем отправлять инструкции для указанного трека.
Обозначение устройства воспроизведения - USB-накопитель 7E FF 06 09 00 00 01 xx xx EF xx xx: означает проверку
Обозначение устройства воспроизведения-TF Card 7E FF 06 09 00 00 02 xx xx EF
Обозначение устройства воспроизведения-PC 7E FF 06 09 00 00 03 xx xx EF означает режим [скачать]
Обозначение устройства воспроизведения-FLASH 7E FF 06 09 00 00 04 xx xx EF
Обозначение устройства воспроизведения-SLEEP 7E FF 06 09 00 00 05 xx xx EF

3.4.5 ложиться спать
Переход в спящий режим 7E FF 06 0A 00 00 00 FE F1 EF xx xx: означает проверку
После того, как Чип переходит в спящий режим, есть два способа разбудить чип или модуль
(1), укажите устройство для воспроизведения, укажите диск U или карту TF, или
Вспышка может проснуться.
(2), текущее устройство отключено один раз, а затем подключено, также можно сразу разбудить
После того, как чип или модуль переходит в сон, резервная мощность составляет около 10 мА.Расход энергии зависит
Тем не менее, это больше, поэтому пользователи имеют требования к энергопотреблению, пожалуйста, обратите внимание.Вы можете выбрать
Используйте трубку pmos и Триод для управления питанием чипа или модуля，
Он может быть полностью отключен, когда он не нужен.Как показано справа


7. Справочная процедура
/******************************************************************************
- Реализовать функцию: реализовать чип питания отдельно, чтобы указать, чтобы играть первую песню и вторую песню, основную программу для тестирования пользователя
- Дата :2013-05-06
- Рабочая среда: Кристалл STC: 11.0592 м скорость передачи данных: 9600
- Примечание: отладка ОК на досках развития 51 прктх - - - СТК89К516РД+
Программа тестирования должна быть модулем или схемой чипа, в которой есть устройство онлайн, такое как U-диск,TF-карта, вспышка
******************************************************************************/
#include "REG52.h"

# define COMM_BAUD_RATE 9600 / / скорость последовательной передачи данных
# define OSC_FREQ 11059200 / / рабочий Кристалл: 11.05926 МГц
static INT8U Send_buf[10] = {0} ;
void Delay_Ms(INT32U z)
{
INT32U x=0 , y=0;
for(x=110 ; x>0 ;x--)
for(y=z; y>0;y-- );
}
/******************************************************************************
- Функция:инициализация последовательного порта 1
- Примечание: установлен на скорость передачи 9600 бод
******************************************************************************/
void Serial_init(void)
{
TMOD = 0x20; / / установка T1 для генератора скорости передачи данных
SCON = 0x50; / / 0101,0000 8 бит данных, без четности
PCON = 0x00; //PCON=0;
TH1=256-(OSC_FREQ/COMM_BAUD_RATE/32/12); / / установлен на скорость передачи 9600 бод
TL1=256-(OSC_FREQ/COMM_BAUD_RATE/32/12);
TR1 = 1; / / таймер 1 включен
REN = 1; / / последовательный порт 1 прием включен
ES = 1; / / прерывание последовательного порта 1 включено
}
void Uart_PutByte(INT8U ch)
{
SBUF = ch;
while(!TI){;}
TI = 0;
}
/******************************************************************************
- Функция: последовательный порт отправляет команды наружу [включая управление и запрос]
- Описание параметра: CMD: означает команду управления, пожалуйста, обратитесь к таблице инструкций, также включает соответствующую инструкцию для запроса
feedback: требуется ли ответ[0: не требуется ответ,1: требуется ответ]
данные: параметры передачи
******************************************************************************/
void SendCmd(INT8U len)
Технология Гуанчжоу Юэсин электронная, ЛТД www.YX080.com руководство по эксплуатации чипа yx6300-24SS
Продажи QQ: 2213825928 45
{
INT8U i = 0 ;
Uart_PutByte (0x7E); / / начало
for (i = 0; i < len; i++) / / данные
{
Uart_PutByte(Send_buf[i]) ;
}
Uart_PutByte (0xEF); //конец
}
/******************************************************************************
- Описание функции: проверка суммирования - - - пользователь также может опустить эту проверку, см. Примечание 5.3.4
- И контрольная сумма идея выглядит следующим образом：
Отправьте инструкции, удалите начало и конец.Промежуточные 6 байтов будут накапливаться и, наконец, принимать обратный код.Приемная сторона получит
Кадр данных, удаление начала и конца.Промежуточные данные накапливаются вместе с полученными контрольными байтами.Просто 0.Таким образом, это поколение.
Данные, полученные в таблице, полностью верны.
******************************************************************************/
void DoSum( INT8U *Str, INT8U len)
{
INT16U xorsum = 0;
INT8U i;
for(i=0; i<len; i++)
{
xorsum = xorsum + Str[i];
}
xorsum = 0 -xorsum;
*(Str+i) = (INT8U)(xorsum >>8);
*(Str+i+1) = (INT8U)(xorsum & 0x00ff);
}
void Uart_SendCMD(INT8U CMD ,INT8U feedback , INT16U dat)
{
Send_buf[0] = 0xff; / / зарезервированные байты
Send_buf [1] = 0x06; //длина
Send_buf[2] = CMD; / / директива управления
Send_buf[3] = feedback; / / нужна ли обратная связь
Send_buf[4] = (INT8U)(dat >> 8);//datah
Send_buf[5] = (INT8U)(dat); //datal
DoSum (&Send_buf[0],6); //проверка
SendCmd (8); / / отправка данных этого кадра
}
void main()
{
Serial_init (); / / настройка инициализации последовательного регистра
Uart_SendCMD (0x03, 0, 0x01); / / воспроизведение первой песни
Delay_Ms (1000); / / задержка примерно 6S
Uart_SendCMD (0x03, 0, 0x02); / / воспроизведение второй песни
Delay_Ms (1000); / / задержка примерно 6S
Uart_SendCMD (0x03, 0, 0x04); / / воспроизведение четвертой песни
while(1);
}

































